{"remainingRequest":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!E:\\2023spring\\sci\\vue3-bigData\\src\\views\\homepage\\components\\cityCount.vue?vue&type=template&id=234cd082","dependencies":[{"path":"E:\\2023spring\\sci\\vue3-bigData\\src\\views\\homepage\\components\\cityCount.vue","mtime":1676359297068},{"path":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1676359411943},{"path":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\babel-loader\\lib\\index.js","mtime":1676359413493},{"path":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1676359414755},{"path":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1676359411943},{"path":"E:\\2023spring\\sci\\vue3-bigData\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1676359413934}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXBwZXIiIHJlZj0iY2l0eUNvdW50Ij48L2Rpdj4NCg=="},{"version":3,"sources":["E:\\2023spring\\sci\\vue3-bigData\\src\\views\\homepage\\components\\cityCount.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC","file":"E:/2023spring/sci/vue3-bigData/src/views/homepage/components/cityCount.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <div class=\"chart-wrapper\" ref=\"cityCount\"></div>\r\n</template>\r\n\r\n<script>\r\nimport echarts from \"echarts\";\r\nimport { onMounted, onBeforeUnmount, ref, watch } from \"vue\";\r\nimport { debounce } from \"@/utils/index.js\";\r\n\r\nimport useResize from \"@/componentApi/useResize.js\";\r\nimport { selectCityData } from \"@/api/chart\";\r\n\r\nexport default {\r\n  name: \"cityCount\",\r\n  setup() {\r\n    let { abcode, year, parentInfo, routerChange } = useResize();\r\n\r\n    const cityCount = ref(null);\r\n    let myChart = ref(null);\r\n\r\n    const resizeHandler = debounce(() => {\r\n      if (myChart) {\r\n        myChart.resize();\r\n      }\r\n    }, 200);\r\n\r\n    onMounted(() => {\r\n      getChartData();\r\n      window.addEventListener(\"resize\", resizeHandler);\r\n    });\r\n    onBeforeUnmount(() => {\r\n      window.removeEventListener(\"resize\", resizeHandler);\r\n    });\r\n\r\n    //模拟接口，获取echarts数据\r\n    const getChartData = async () => {\r\n      const { data } = await selectCityData({\r\n        abcode,\r\n        year,\r\n      });\r\n      let xData = [],\r\n        yData = [];\r\n      data.forEach((item) => {\r\n        xData.push(item.name);\r\n        yData.push(item.value);\r\n      });\r\n      initEcharts(xData, yData);\r\n    };\r\n\r\n    //渲染echarts图\r\n    const initEcharts = (xData, yData) => {\r\n      myChart = echarts.init(cityCount.value);\r\n      myChart.setOption(\r\n        {\r\n          grid: {\r\n            left: \"13%\",\r\n            right: \"8%\",\r\n            bottom: \"25%\",\r\n            top: \"10%\",\r\n          },\r\n          title: {\r\n            show: xData.length === 0,\r\n            top: \"center\",\r\n            left: \"center\",\r\n            text: \"暂无数据\",\r\n            textStyle: {\r\n              color: \"rgb(179, 239, 255)\",\r\n              fontSize: 12,\r\n            },\r\n          },\r\n          tooltip: {\r\n            trigger: \"axis\",\r\n            axisPointer: {\r\n              type: \"shadow\",\r\n            },\r\n            formatter: (params) => {\r\n              return params[0].name + \"<br>销售额度：\" + params[0].value + \"万\";\r\n            },\r\n          },\r\n          toolbox: {\r\n            feature: {\r\n              dataView: {\r\n                show: false,\r\n              },\r\n              magicType: {\r\n                show: true,\r\n                type: [\"line\", \"bar\"],\r\n              },\r\n              restore: {\r\n                show: false,\r\n              },\r\n              saveAsImage: {\r\n                show: true,\r\n                name: year.value + \"年销售额排名\",\r\n                pixelRatio: 2,\r\n              },\r\n            },\r\n            iconStyle: {\r\n              normal: {\r\n                borderColor: \"#1990DA\",\r\n              },\r\n            },\r\n            top: 0,\r\n            right: 5,\r\n          },\r\n          dataZoom: [\r\n            {\r\n              type: \"inside\",\r\n              startValue: 0,\r\n              endValue: 10,\r\n            },\r\n          ],\r\n          xAxis: {\r\n            type: \"category\",\r\n            axisLine: {\r\n              lineStyle: {\r\n                color: \"#397cbc\",\r\n              },\r\n            },\r\n            splitLine: {\r\n              show: false,\r\n            },\r\n            axisTick: {\r\n              show: false,\r\n            },\r\n            //轴线上的字\r\n            axisLabel: {\r\n              show: true,\r\n              textStyle: {\r\n                color: \"#cecece\",\r\n                fontSize: 12,\r\n              },\r\n              rotate: 15,\r\n            },\r\n            data: xData,\r\n          },\r\n          yAxis: [\r\n            {\r\n              type: \"value\",\r\n              axisTick: {\r\n                show: false,\r\n              },\r\n              //轴线上的字\r\n              axisLabel: {\r\n                textStyle: {\r\n                  fontSize: 12,\r\n                  color: \"#cecece\",\r\n                },\r\n              },\r\n              axisLine: {\r\n                lineStyle: {\r\n                  color: \"#397cbc\",\r\n                },\r\n              },\r\n              //网格线\r\n              splitLine: {\r\n                lineStyle: {\r\n                  color: \"#11366e\",\r\n                },\r\n              },\r\n            },\r\n          ],\r\n          series: [\r\n            {\r\n              name: \"销售额度\",\r\n              type: \"bar\",\r\n              data: yData,\r\n              barWidth: \"45%\",\r\n              itemStyle: {\r\n                color: new echarts.graphic.LinearGradient(\r\n                  0,\r\n                  0,\r\n                  0,\r\n                  1,\r\n                  [\r\n                    {\r\n                      offset: 0,\r\n                      color: \"#01BDF4\",\r\n                    },\r\n                    {\r\n                      offset: 1,\r\n                      color: \"#083AF6 \",\r\n                    },\r\n                  ],\r\n                  false\r\n                ),\r\n              },\r\n            },\r\n          ],\r\n        },\r\n        true\r\n      );\r\n\r\n      myChart.getZr().off(\"click\");\r\n      myChart.getZr().on(\"click\", (params) => {\r\n        const pointInPixel = [params.offsetX, params.offsetY];\r\n        if (myChart.containPixel(\"grid\", pointInPixel) || xData.length === 0) {\r\n          routerChange(\"/more\");\r\n        }\r\n      });\r\n    };\r\n\r\n    watch(\r\n      year,\r\n      (nl, ol) => {\r\n        getChartData();\r\n      },\r\n      { lazy: false }\r\n    );\r\n    watch(\r\n      parentInfo,\r\n      (nl, ol) => {\r\n        getChartData();\r\n      },\r\n      { lazy: false, deep: true }\r\n    );\r\n\r\n    return {\r\n      cityCount,\r\n    };\r\n  },\r\n};\r\n</script>\r\n"]}]}